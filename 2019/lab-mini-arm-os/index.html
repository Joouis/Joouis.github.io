<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/hacker.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/hacker.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/hacker.ico">
  <link rel="mask-icon" href="/images/hacker.ico" color="#222">
  <meta name="google-site-verification" content="NbLkH228plarNfqTQkFa_uQ_H8j5Q3LNExDwLMXAxog">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"joouis.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"hide","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"duration":100,"transition":{"menu_item":"fadeIn","post_block":"fadeIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/config.min.js"></script>

    <meta name="description" content="è¿™æ˜¯æˆ‘çš„åµŒå…¥å¼ç¬”è®°ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚ å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘&#x2F;çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚ è¿™ä¸ªå®éªŒé™¤äº†">
<meta property="og:type" content="article">
<meta property="og:title" content="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ">
<meta property="og:url" content="https://joouis.com/2019/lab-mini-arm-os/index.html">
<meta property="og:site_name" content="æ±Ÿè¾¹çš„æ—±é¸­å­">
<meta property="og:description" content="è¿™æ˜¯æˆ‘çš„åµŒå…¥å¼ç¬”è®°ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚ å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘&#x2F;çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚ è¿™ä¸ªå®éªŒé™¤äº†">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">
<meta property="og:image" content="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&height=118&cropmode=none">
<meta property="og:image" content="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&height=167&cropmode=none">
<meta property="og:image" content="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&height=182&cropmode=none">
<meta property="og:image" content="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&height=457&cropmode=none">
<meta property="og:image" content="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&height=422&cropmode=none">
<meta property="article:published_time" content="2019-12-29T14:21:16.000Z">
<meta property="article:modified_time" content="2019-12-29T14:21:16.000Z">
<meta property="article:author" content="John Chou">
<meta property="article:tag" content="TechTalk">
<meta property="article:tag" content="embedded system course">
<meta property="article:tag" content="embedded system">
<meta property="article:tag" content="arm">
<meta property="article:tag" content="os">
<meta property="article:tag" content="gnu">
<meta property="article:tag" content="context switch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none">


<link rel="canonical" href="https://joouis.com/2019/lab-mini-arm-os/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://joouis.com/2019/lab-mini-arm-os/","path":"2019/lab-mini-arm-os/","title":"ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ | æ±Ÿè¾¹çš„æ—±é¸­å­</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-E247SGMNGH"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-E247SGMNGH","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/analytics/google-analytics.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/analytics/baidu-analytics.min.js"></script>
  <script async src="https://hm.baidu.com/hm.js?199f195e233fd5ecca0d9346d3259670"></script>







  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="æ±Ÿè¾¹çš„æ—±é¸­å­" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">æ±Ÿè¾¹çš„æ—±é¸­å­</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Blog of John Chou</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section">é¦–é¡µ</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section">å½’æ¡£</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section">åˆ†ç±»</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section">å…³äº</a></li><li class="menu-item menu-item-recruit"><a href="/recruit/" rel="section">æ‹›è˜</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="nav-number">1.</span> <span class="nav-text">å‡†å¤‡å·¥ä½œ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mini-ARM-OS"><span class="nav-number">2.</span> <span class="nav-text">Mini ARM OS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#00-HelloWorld"><span class="nav-number">2.1.</span> <span class="nav-text">00-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#01-HelloWorld"><span class="nav-number">2.2.</span> <span class="nav-text">01-HelloWorld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#02-ContextSwitch-1"><span class="nav-number">2.3.</span> <span class="nav-text">02-ContextSwitch-1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#03-ContextSwitch-2"><span class="nav-number">2.4.</span> <span class="nav-text">03-ContextSwitch-2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#04-Multitasking"><span class="nav-number">2.5.</span> <span class="nav-text">04-Multitasking</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#05-TimerInterrupt"><span class="nav-number">2.6.</span> <span class="nav-text">05-TimerInterrupt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#06-Preemptive"><span class="nav-number">2.7.</span> <span class="nav-text">06-Preemptive</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="John Chou"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">John Chou</p>
  <div class="site-description" itemprop="description">Stand high, think different.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">265</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Joouis" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;Joouis" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luckyjoou@gmail.com" title="E-Mail â†’ mailto:luckyjoou@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/Joouis" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;Joouis" rel="noopener me" target="_blank"><i class="fab fa-instagram fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="http://www.slideshare.net/choujohn351" title="SlideShare â†’ http:&#x2F;&#x2F;www.slideshare.net&#x2F;choujohn351" rel="noopener me" target="_blank"><i class="fab fa-slideshare fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nd/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nd.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://joouis.com/2019/lab-mini-arm-os/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="John Chou">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ±Ÿè¾¹çš„æ—±é¸­å­">
      <meta itemprop="description" content="Stand high, think different.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ | æ±Ÿè¾¹çš„æ—±é¸­å­">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2019-12-29 22:21:16" itemprop="dateCreated datePublished" datetime="2019-12-29T22:21:16+08:00">2019-12-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">åˆ†ç±»äº</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%B3%BB%E7%BB%9F%E4%B8%8E%E5%BA%95%E5%B1%82/" itemprop="url" rel="index"><span itemprop="name">ç³»ç»Ÿä¸åº•å±‚</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="é˜…è¯»æ—¶é•¿">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">é˜…è¯»æ—¶é•¿ &asymp;</span>
      <span>9 åˆ†é’Ÿ</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>è¿™æ˜¯æˆ‘çš„<a href="https://joouis.com/2019/watching-notes-revolution-os/">åµŒå…¥å¼ç¬”è®°</a>ç¬¬å››ç¯‡ï¼ŒåŸæ–‡å†™äº2015å¹´ã€‚</p>
<p>å°è±¡ä¸­å›½å†…çš„åµŒå…¥å¼å¼€å‘è¿˜æ˜¯ï¼ˆå¯èƒ½æ˜¯ç›—ç‰ˆçš„ï¼‰IDE åŠ è½½é¡¹ç›®å·¥ç¨‹åä¸€é”®ç¼–è¯‘&#x2F;çƒ§å½•çš„æ¨¡å¼ï¼Œå¼€å‘äººå‘˜å¯¹åº•å±‚åƒçš„ä¸å¤Ÿé€ï¼Œç¦»å¼€ IDE æˆ–è€…æ¢ä¸ªå¼€å‘ç¯å¢ƒçŠ¹å¦‚æ·±åº¦è¿‘è§†æ‚£è€…ç¦»å¼€äº†çœ¼é•œâ€”â€”å¯¸æ­¥éš¾è¡Œã€‚å†è¯´è¿œä¸€ç‚¹ï¼Œä¼¼ä¹ä¸å°‘äººçš„å­¦ä¹ è·¯å¾„éƒ½æ˜¯é€šè¿‡çœ‹ä¸­æ–‡æ•™æå’Œä¸€äº›åŸ¹è®­ç­è§†é¢‘ï¼ˆæˆ‘å½“å¹´ä¹Ÿçœ‹è¿‡éƒ­å¤©ç¥¥å’ŒéŸ¦ä¸œå±±çš„è§†é¢‘ğŸ˜‚ï¼‰ï¼Œç¼ºä¹â€œä¸€æ‰‹â€çŸ¥è¯†çš„æ‘„å–å’Œä½“ç³»åŒ–çš„è®­ç»ƒã€‚</p>
<p>è¿™ä¸ªå®éªŒé™¤äº†å¯ä»¥æ·±å…¥äº†è§£æ“ä½œç³»ç»Ÿçš„åº•å±‚è¡Œä¸ºå¦‚ä¸Šä¸‹æ–‡åˆ‡æ¢å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéš¾ç‚¹å°±æ˜¯è¦åœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ GNU Toolchain ç¼–è¯‘é“¾æ¥ç³»ç»Ÿï¼Œæœ€ç»ˆçƒ§å½•åˆ° ARM ç¡¬ä»¶ä¸Šï¼Œéå¸¸éå¸¸çš„â€œç¡¬æ ¸â€ã€‚</p>
<span id="more"></span>



<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>æˆ‘ä»¬ä½¿ç”¨çš„ç¡¬ä»¶æ˜¯æ„æ³•åŠå¯¼ä½“å‡ºçš„ STM32F4 Discovery å¼€å‘æ¿ï¼Œåœ¨å¼€å§‹å®éªŒä¹‹å‰ï¼Œäº†è§£ MCUã€ç”µè·¯å¸ƒå±€ä»¥åŠå¦‚ä½•åœ¨ STM32 MCU ä¸Šå¼€å‘éƒ½æ˜¯å¿…ä¸å¯ç¼ºçš„æ­¥éª¤ï¼Œä¸»è¦å°±æ˜¯é˜…è¯»å¤§é‡èµ„æ–™ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.google.com/document/d/1Ygl6cEGPXUffhTJE0K6B8zEtGmIuIdCjlZBkFlijUaE/edit">STM32 ç¨‹å¼é–‹ç™¼ï¼šä»¥ GNU Toolchain ç‚ºä¾‹</a></li>
<li>ld: <a target="_blank" rel="noopener" href="http://www.math.utah.edu/docs/info/ld_toc.html#SEC1">Using ld, The GNU linker</a>, <a target="_blank" rel="noopener" href="http://wen00072-blog.logdown.com/posts/246071-study-on-the-linker-script-3">GNU LD æ‰‹å†Šç•¥è®€ (3): Chapter 3.7 ~ Chapter 3.11</a></li>
<li>STM32: Reference Manual, Datasheet, Schematicsï¼ˆè‡ªè¡ŒæŸ¥é˜…å®˜ç½‘æœ€æ–°ç‰ˆæœ¬ï¼‰</li>
<li>Course: <a target="_blank" rel="noopener" href="http://wiki.csie.ncku.edu.tw/embedded/Lab42">Lab42: Mini ARM OS</a></li>
</ul>
<h2 id="Mini-ARM-OS"><a href="#Mini-ARM-OS" class="headerlink" title="Mini ARM OS"></a><a target="_blank" rel="noopener" href="https://github.com/jserv/mini-arm-os">Mini ARM OS</a></h2><p>GitHub ä»“åº“ç‚¹å‡»æ ‡é¢˜å³å¯è®¿é—®ï¼Œæ²¡æƒ³åˆ°å·²ç»æœ‰ 530 é¢—æ˜Ÿæ˜Ÿäº†ï¼ˆ12&#x2F;29&#x2F;2019ï¼‰ï¼ä»¥ä¸‹ç¬”è®°å¯¹åº”å››å¹´å‰çš„ç‰ˆæœ¬ï¼Œå°‘äº†ç¬¬ 7 å’Œç¬¬ 8 è¯¾ï¼Œä»£ç å¯èƒ½ä¹Ÿæœ‰æ‰€æ”¹åŠ¨ï¼Œå‹¿æ€ªã€‚</p>
<h3 id="00-HelloWorld"><a href="#00-HelloWorld" class="headerlink" title="00-HelloWorld"></a>00-HelloWorld</h3><ul>
<li><p>å…ˆmakeç„¶å¾Œmake qemuå¾Œå‡ºç¾hello worldï¼Œç„¶å¾Œè¼¸å…¥arm-none-eabi-objdump -D hello.elfæŸ¥çœ‹executable and linkableæ–‡ä»¶</p>
<p><img data-src="https://jjrgxq.bn.files.1drv.com/y4mJ8PzIgxQl8A49jOlzN8ngCzqii5YaShYpXtm7oZFdUKMwF7GX1ZvPSBRvNfGjuLiBYh1YRzy5m9vWSIjvqP8TZMiALCPL7Y7_JcBbPlnbz9Y5YvrJOa1aR-YJcvnilcffA1dvNXRl0nl6ftucjPS_KPPAJPEC7gc3RGTIADvO3VyL08t_k_QhbIxEsv9M696VtfKDugudAjbONaHfx1rBA?width=665&height=196&cropmode=none"></p>
<p><img data-src="https://jjrexq.bn.files.1drv.com/y4mmQTIAfh9s6wUyEBnPh-M49mtDXgVblanK_JMDZ8AJvYcFVaQpvhGvPxWHAn6pD7_QbqJheIOAgjB1dYOut7kJea25hzUuiyfyK65bBOE1kJCDYyG3gvp_ARYSSckueCeag8T8ATchYqg7vHDg8eMVdoEs-S0rB2TS1p8VyPY-mDSQoxfT0GBxJEJs1LlOGJxjj-7UgZXqk0R55uykuA_ag?width=370&height=118&cropmode=none"></p>
</li>
<li><p>é€™è£å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨M3ä¸Šé›»å–å‡ºMSPå¾Œï¼Œæœƒå–å‡ºPCçš„å€¼ï¼Œåœ–ä¸­å¯è¦‹æ˜¯0x000000adã€‚ä½†å¯¦éš›ä¸Šreset_handleråœ°å€æ˜¯å¾000000acé–‹å§‹çš„ã€‚é€™æ˜¯å› çˆ²ï¼š</p>
<p>ç•¶ä¸€å€‹ä¾‹å¤–è™•ç†ç¨‹å¼(exception handler)çš„ä½å€åœ¨LSBè¨­å®šç‚º1ï¼Œä»£è¡¨è©²ä¾‹å¤–è™•ç†ç¨‹å¼é‹ä½œæ–¼Thumbæ¨¡å¼(Thumb mode)ï¼Œå°ARM Cortex-M3ä¾†èªªï¼Œé€™æ˜¯å¿…è¦çš„ï¼Œå› ç‚ºè©²è™•ç†å™¨æ ¸å¿ƒåªæ”¯æ´Thumb-2æŒ‡ä»¤é›†ï¼Œè€Œä¸æ”¯æ´ARMæ¨¡å¼(ä¹Ÿç¨±ARM codeæˆ–ARM state)ã€‚</p>
<p>æ‰€ä»¥<a target="_blank" rel="noopener" href="http://wiki.csie.ncku.edu.tw/embedded/Lab42">http://wiki.csie.ncku.edu.tw/embedded/Lab42</a> çš„æˆªåœ–è£ï¼Œreset_handleræ˜¯å¾0x000000adæ˜¯å¯¦éš›ç·¨è­¯å™¨åœ¨ä¸åŒæ©Ÿå™¨ä¸‹ç·¨è­¯å‡ºä¾†çš„ä¸åŒï¼Ÿ</p>
</li>
<li><p>æ­é…hello.ldå’Œstartup.cä¸€èµ·çœ‹çµ‚æ–¼æœ‰ç¨®æç„¶å¤§æ‚Ÿçš„æ„Ÿè¦ºã€‚.text sectionæœ€å‰é¢çš„ä½ç½®å°±æ˜¯isr_vectorï¼Œç„¶å¾Œå†æ˜¯å…¶ä»–.textæ–‡ä»¶ã€‚ç•¶m3å¾Flashé–‹å§‹è®€å…¥æ•¸æ“šæ™‚ï¼Œé¦–å…ˆå°±æ˜¯isr_vectorçš„å…§å®¹ï¼Œè€Œisr_vectorä¸­é¦–å…ˆçµ¦MSPåœ°å€è³¦0ï¼Œç„¶å¾Œæ˜¯reset_handlerï¼Œè€Œreset_handleræŒ‡å‘Mainå‡½æ•¸ï¼Œé€™æ¨£å°±å°å…¥æˆ‘å€‘å¯«çš„ä¸»å‡½æ•¸äº†</p>
</li>
</ul>
<h3 id="01-HelloWorld"><a href="#01-HelloWorld" class="headerlink" title="01-HelloWorld"></a>01-HelloWorld</h3><ul>
<li><p>æ­¤å¯¦é©—å’Œ00ç›¸æ¯”åœ¨ldä¸Šä½œäº†æ›´å¤šæ–‡ç« ã€‚00-HelloWorldçš„ldæ–‡ä»¶åƒ…é…ç½®äº†Flashå’Œ.text sectionï¼Œè€Œ01ä¸­å‰‡å¤šé…ç½®äº†RAMï¼Œå°‡é‹è¡Œæ™‚ä¸æœƒæ›´æ”¹çš„.textã€.rodataã€æ”¾å…¥.text sectionä¸­ï¼Œ.dataæ”¾å…¥.data sectionä¸­</p>
</li>
<li><p>ATçš„_sidataè¡¨ç¤ºäº†.dataè¼‰å…¥RAMå¾Œçš„LMAã€‚å› çˆ²data sectionæœƒå¾flashæ¬ç§»åˆ°SRAMä¸­ï¼Œå› æ­¤å®ƒçš„LMAå’ŒVMAæœƒä¸åŒã€‚é€£çµå™¨è…³æœ¬çš„ä¸€å€‹é‡è¦ä½œç”¨ï¼Œå°±æ˜¯ç®¡ç†å€‹åˆ¥sectionçš„LMAå’ŒVMAï¼Œä¸¦åœ¨å¿…è¦çš„æƒ…æ³ä¸‹ï¼ŒæŠŠæœ‰é—œè³‡è¨Šæä¾›çµ¦ç¨‹å¼ç¨‹å¼ç¢¼ä½¿ç”¨ã€‚</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Copy the data segment initializers from flash to SRAM */</span></span><br><span class="line"><span class="type">uint32_t</span> *idata_begin = &amp;_sidata;</span><br><span class="line"><span class="type">uint32_t</span> *data_begin = &amp;_sdata;</span><br><span class="line"><span class="type">uint32_t</span> *data_end = &amp;_edata;</span><br><span class="line"><span class="keyword">while</span> (data_begin &lt; data_end) *data_begin++ = *idata_begin++;</span><br></pre></td></tr></table></figure>



<h3 id="02-ContextSwitch-1"><a href="#02-ContextSwitch-1" class="headerlink" title="02-ContextSwitch-1"></a>02-ContextSwitch-1</h3><ul>
<li>åœ¨startup.cä¸­å®šç¾©äº†nmi_handlerå’Œhardfault_handlerï¼Œåœ°å€åœ¨reset_handlerä¹‹å¾Œï¼Œä»€éº¼æ™‚å€™æœƒè§¸ç™¼ä»–å€‘å‘¢ï¼Ÿ</li>
<li>mspçš„å€¼çˆ²_estack&#x3D;RAMçš„åˆå§‹ä½ç½®åŠ ä¸ŠRAMçš„å¯¬åº¦ï¼Œå³0x20000000+40kï¼Œé€™æ¨£æ„å‘³é€™stackçš„çˆ²40Kå¤§å°ï¼Œé€™å€‹å¤§å°çš„stackæ„Ÿè¦ºè¶³å¤ å¯¬è£•ï¼</li>
<li>æ¥ç€çœ‹os.cè£çš„mainå‡½æ•¸<ul>
<li>cortex-mç³»åˆ—è™•ç†å™¨<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html">core registers</a></li>
<li>é¦–å…ˆå®šç¾©é¡usertaskçš„å †æ£§å¤§å°256*4byte&#x3D;1kï¼Œç„¶å¾Œå®šç¾©ä¸€å€‹æŒ‡é‡*usertask_stack_startæŒ‡å‘usertaskå †æ£§åŠ 256-16çš„è·é›¢ï¼Œè€Œusertaskçš„åœ°å€å¾usertask_stack_startæ£§åº•-8æ‰é–‹å§‹ï¼Œé€™ä¸­é–“å¤šå‡ºäº†24byteã€‚æˆ‘æƒ³é€™æ‡‰è©²æ˜¯call stackçš„æ¦‚å¿µï¼Œçˆ²äº†å¾Œé–€èª¿ç”¨usertaskå‡½æ•¸çš„argumentã€return addressã€saved ebp%ç­‰ç•™ä¸‹ç©ºé–“(24byteæ‡‰è©²æ˜¯6å€‹ç©ºæ ¼)</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Initialization of process stack.</span></span><br><span class="line"><span class="comment">     * r4, r5, r6, r7, r8, r9, r10, r11, lr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> usertask_stack[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> *usertask_stack_start = usertask_stack + <span class="number">256</span> - <span class="number">16</span>;</span><br><span class="line">    usertask_stack_start[<span class="number">8</span>] = (<span class="type">unsigned</span> <span class="type">int</span>) &amp;usertask;</span><br><span class="line"></span><br><span class="line">    usart_init();</span><br><span class="line"></span><br><span class="line">    print_str(<span class="string">&quot;OS Starting...\n&quot;</span>);</span><br><span class="line">    activate(usertask_stack_start);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// while (1); /* We can&#x27;t exit, there is nowhere to go */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>contex_swtich.sä¸­.syntax unifiedï¼šCortex-m3çˆ²äº†å…¼å®¹thumbæŒ‡ä»¤å’Œthumb2æŒ‡ä»¤ï¼Œä½¿é€™å…©ç¨®æŒ‡ä»¤å¯ä»¥ä½¿ç”¨çµ±ä¸€çš„æ ¼å¼ï¼Œå¼•å…¥äº†ä¸€ç¨®å«åšâ€œUALâ€çš„èªæ³•æ©Ÿåˆ¶ã€‚ç°¡å–®èªªä¾†å°±æ˜¯ç¨‹åºå“¡ä¸ç”¨é—œå¿ƒè‡ªå·±ä½¿ç”¨çš„æ˜¯thumbé‚„æ˜¯thumb2æŒ‡ä»¤ï¼Œè€Œæ˜¯çµ±ä¸€ä½¿ç”¨32ä½thumb2æŒ‡ä»¤çš„èªæ³•æ ¼å¼æ›¸å¯«ã€‚å…·é«”çš„æ©Ÿå™¨æŒ‡ä»¤æ˜¯16ä½é‚„æ˜¯32ä½ç”±ç·¨è­¯å™¨ä¾†æ±ºå®šã€‚.syntax unifiedçš„ä½œç”¨å°±æ˜¯åˆ¶å®šä½¿ç”¨é€™ä¸€åŠŸèƒ½ï¼Œå…·é«”å¯ä»¥åƒè€ƒã€Šcortex-m3æ¬Šå¨æŒ‡å—ã€‹ã€‚</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* save kernel state */</span><br><span class="line">mrs ip, psr</span><br><span class="line">push &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">/* switch to process stack */</span><br><span class="line">msr psp, r0</span><br><span class="line">mov r0, #3</span><br><span class="line">msr control, r0</span><br><span class="line">/* load user state */</span><br><span class="line">pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line">/* jump to user task */</span><br><span class="line">bx lr</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ¥ç€é€™æ®µä»£ç¢¼ï¼š</p>
<ul>
<li><p>MRSï¼šMove to ARM register from system coprocessor register. MRS <em>Rn</em>, <em>coproc_register</em>ä¸­Rn is the ARM destination register, and R<em>n</em> must not be PC. System coprocessor registeræ‡‰è©²æ˜¯é‚£äº›special registersï¼Œå…¶ä¸­åŒ…å«psr(Program status register)ã€‚MSRåä¹‹ã€‚</p>
</li>
<li><p>å°‡mainå‡½æ•¸(kernel)çš„ç‹€æ…‹å­˜å…¥å †æ£§å¾Œï¼Œå°‡r0æ•¸æ“šå­˜å…¥ç¨‹åºç‹€æ…‹å¯„å­˜å™¨(æ­¤æ™‚r0æ‡‰è©²å­˜æ”¾äº†usertask_stack_startåœ°å€)ï¼Œç„¶å¾Œè¨­å®š<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html">controlå¯„å­˜å™¨</a>çˆ²0b11ã€‚æ‰€ä»¥ç¾åœ¨stack pointeræ˜¯PSPï¼Œè€ŒPSPä¸­å­˜æ”¾çš„æ˜¯usertask_stack_startåœ°å€ï¼Œè‡³æ–¼Thread modeæ˜¯Unprivilegedã€‚</p>
<p><img data-src="https://jjrfxq.bn.files.1drv.com/y4msLq_CmDAujSrfYA8NuEC4ZHMdSokzk4fhPw5YtLQH5vRK5lTnPVFKRcXSDRJ218o_HUpoRvIU16gqEzz0hrYvwbtpAYbDUIw2645rEcIvYlGMMQFSj4K5OxC1tbFuul69ySeIejiKNiKMEa0D9Wk6k7xTN7ORra40ulPvgQP4N32iv3LjrqgG2RdMNLKZ4HRmQ6g3gZ5zMMYNaLagz4OeA?width=836&height=167&cropmode=none"></p>
</li>
<li><p>æœ€å¾ŒæŠŠusertask_stackä¸­çš„å¯„å­˜å™¨å€¼æ‹¿å‡ºä¾†ï¼Œå°±å¯ä»¥è·³è½‰åˆ°user stateäº†</p>
</li>
<li><p>æ­¤å¤„è¡¥å……ä¸¤ç¯‡ ARM å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dai0179b/ar01s02s06.html">2.6. Execution Modes</a>, <a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDIGFCA.html">2.1.1. Processor mode and privilege levels for software execution</a></p>
</li>
</ul>
</li>
</ul>
<h3 id="03-ContextSwitch-2"><a href="#03-ContextSwitch-2" class="headerlink" title="03-ContextSwitch-2"></a>03-ContextSwitch-2</h3><ul>
<li>startup.cä¸­å¤šäº†ä¸€äº›è²æ˜ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">nmi_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">hardfault_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">memmanage_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">busfault_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">usagefault_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">svc_handler</span><span class="params">(<span class="type">void</span>)</span> __<span class="title function_">attribute</span><span class="params">((weak, alias(<span class="string">&quot;default_handler&quot;</span>)))</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>alias (â€œtargetâ€): The alias attribute causes the declaration to be emitted as an alias for another symbol, which must be specified.</li>
<li>æ‰€ä»¥*_handlerå…¨éƒ¨aliasåˆ°äº†default_handlerä¸Šï¼Œè€Œdefault_handlerç›®å‰çˆ²ä¸€å€‹æ­»å¾ªç’°ï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">default_handler</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>syscallçš„å®šç¾©ï¼Œé—œæ–¼ <code>svc 0</code> é€™å€‹<a target="_blank" rel="noopener" href="https://reverseengineering.stackexchange.com/questions/4217/arm-shellcode-for-linux-svc-0-vs-svc-1">å›ç­”</a>å¾ˆå¥½</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">syscall:</span><br><span class="line">    svc 0</span><br><span class="line">    nop</span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨context_switch.Sä¸­å®šç¾©äº†svc_handlerå‡½æ•¸ï¼Œè¯æƒ³åˆ°startup.cä¸­çš„weak aliasï¼Œå¯ä»¥ç†è§£weak aliasçš„æ„æ€å°±æ˜¯ç·¨è­¯å™¨å‡å¦‚åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ°äº†æŸå€‹å‡½æ•¸çš„å®šç¾©å°±æœƒç·¨è­¯ï¼Œå‡å¦‚æ²’æœ‰æ‰¾åˆ°å°±æœƒå°‡å…¶aliasåˆ°æŒ‡å®šçš„weak aliaså‡½æ•¸ã€‚<ul>
<li>é—œæ–¼<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/BABCAEDD.html">stmdb</a>ï¼Œstmä»£è¡¨å­˜å„²æ›´å¤šå¯„å­˜å™¨ï¼Œdbä»£è¡¨åœ¨ç²å–å‰å°‡åœ°å€æ¸›å°ã€‚æ‰€ä»¥å°±æ˜¯r0åœ°å€æœƒå¢åŠ 9*4bytesï¼Œç„¶å¾Œå°‡{}ä¸­çš„9å€‹å¯„å­˜å™¨å¾å·¦è‡³å³å¾æœ€ä½ä½ç½®é–‹å§‹å­˜æ”¾</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">svc_handler:</span><br><span class="line">	/* save user state */</span><br><span class="line">    mrs r0, psp</span><br><span class="line">    stmdb r0!, &#123;r4, r5, r6, r7, r8, r9, r10, r11, lr&#125;</span><br><span class="line"></span><br><span class="line">    /* load kernel state */</span><br><span class="line">    pop &#123;r4, r5, r6, r7, r8, r9, r10, r11, ip, lr&#125;</span><br><span class="line">    msr psr, ip</span><br><span class="line"></span><br><span class="line">    bx lr</span><br></pre></td></tr></table></figure>

<p><img data-src="https://jjrdxq.bn.files.1drv.com/y4mRQE5Fump95yZuOzBhNqQ7N5_mzTHEVTypYmPw6OHq2azZPtqvM4q-f1CQdM3kUuGab_l9cDzwEGC-g-wa2M8kUk_WTJOp6PJslaqSky-9HJ5P53vGzibCYaJ1D2_jXAc1eePfITeY4U7wj74WMt84mXkivWuGUX_F-xlWEItxxLJriI_-qID5ZYLFL0nFYYgQT_L1hRr6h2Nc4Mlcp7Wag?width=330&height=182&cropmode=none"></p>
<ul>
<li>ç¨‹åºrunå¯è¦‹ç•¶usertaskè§¸ç™¼syscallå¾Œæœƒä¿å­˜å…¶ç‹€æ…‹ï¼Œç„¶å¾Œåˆ‡å›mainå‡½æ•¸è¼¸å‡ºå…©å€‹print_strï¼Œç„¶å¾Œå›åˆ°usertaskå¾Œæœƒç¹¼çºŒæ¥ç€ä¸Šä¸€æ¬¡çš„åŸ·è¡Œåˆ°çš„åœ°æ–¹ç¹¼çºŒåŸ·è¡Œï¼Œå†è¼¸å‡ºå…©å¥è©±ï¼Œç„¶å¾Œå›åˆ°mainå‡½æ•¸ï¼Œä¹Ÿæ˜¯æ¥ç€ä¸Šæ¬¡åŸ·è¡Œå¾Œçš„åœ°æ–¹ç¹¼çºŒåŸ·è¡Œã€‚é€™é©—è­‰äº†ä¹‹å‰ä»£ç¢¼è£é—œæ–¼user stateå’Œkernel stateçš„saveå’Œloadå‹•ä½œã€‚</li>
</ul>
<h3 id="04-Multitasking"><a href="#04-Multitasking" class="headerlink" title="04-Multitasking"></a>04-Multitasking</h3><p><img data-src="https://jjrcxq.bn.files.1drv.com/y4mxOrwfjpJWXVx10ewRnky1wPwqh2R11XAqx-rK7fYKhfnw0_Q74JArry9kVVn4BgN9X-_uc522FXUMVpDK12AMd4YZJsgAQUcUVqHyS46IaGAxRHw-BAwiecYzVgzOaHf2UiuOJ7Tpfs0_N-XTSa7WMGoHru9BdASIGz_T5kmQcuOST6itBFfUUH9IMIbg8uY6Jqo4lWKAnkXSwQfbY6U-Q?width=710&height=457&cropmode=none"></p>
<ul>
<li><p>diff context_switch.S ..&#x2F;03-ContextSwitch-2&#x2F;context_switch.S ï¼Œç™¼ç¾ï¼š</p>
<ul>
<li>svc_handlerä¸­çš„msr psr, ipè®Šæˆäº†msr psr_nzcvq, ipï¼Œ<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/topic/com.arm.doc.qrc0001mc/QRC0001_UAL.pdf">nzcv</a>çˆ²psrçš„å››å€‹æ¨™èªŒä½</li>
</ul>
</li>
<li><p>å¦å¤–åœ¨activateä¸­ï¼Œåœ¨åˆ‡æ›åˆ°process staskå¾Œå¤šä¸€æ¢isbæŒ‡ä»¤ï¼š</p>
<p>Instruction Synchronization Barrier flushes the pipeline in the processor, so that all instructions following the ISB are fetched from cache or memory, after the instruction has been completed. It ensures that the effects of context altering operations, such as changing the ASID, or completed TLB maintenance operations, or branch predictor maintenance operations, as well as all changes to the CP15 registers, executed before the ISB instruction are visible to the instructions fetched after the ISB.<br>In addition, the ISB instruction ensures that any branches that appear in program order after it are always written into the branch prediction logic with the context that is visible after the ISB instruction. This is required to ensure correct execution of the instruction stream.</p>
</li>
<li><p>é‡é ­æˆ²åœ¨os.cï¼Œé¦–å…ˆå®å®šç¾©äº†ä¸‰å€‹åœ°å€ï¼š</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> HANDLER_MSP 0xFFFFFFF1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THREAD_MSP  0xFFFFFFF9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> THREAD_PSP  0xFFFFFFFD</span></span><br></pre></td></tr></table></figure>

<p><img data-src="https://jjrbxq.bn.files.1drv.com/y4muhuffNAohfnDo-aRDoceuibQPrQEckKbjI4lHjnPFIs9WGd06YSErr1D8mnXD44UqViR2HMQmQ4_wvzsxaCkigz4_EXVvtf8zNBv0r4nCwYj0vwSCu8gaLkmEC28hMXaJ9VXQf0hhqjehXva9wzBL_zppfNl8mBUBl447u-Ml279njbjec48_ELzLOrV7Vcx3spyKlothXlN8JfhBB-NiQ?width=524&height=422&cropmode=none"></p>
<ul>
<li>æ¥ç€æ–°å»ºä¸€å€‹taskï¼š</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> *<span class="title function_">create_task</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *<span class="built_in">stack</span>, <span class="type">void</span> (*start)(<span class="type">void</span>))</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> first = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">stack</span> += STACK_SIZE - <span class="number">32</span>; <span class="comment">/* End of stack, minus what we are about to push */</span></span><br><span class="line">        <span class="keyword">if</span> (first) &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="type">unsigned</span> <span class="type">int</span>) start;</span><br><span class="line">                first = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">8</span>] = (<span class="type">unsigned</span> <span class="type">int</span>) THREAD_PSP;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">15</span>] = (<span class="type">unsigned</span> <span class="type">int</span>) start;</span><br><span class="line">                <span class="built_in">stack</span>[<span class="number">16</span>] = (<span class="type">unsigned</span> <span class="type">int</span>) <span class="number">0x01000000</span>; <span class="comment">/* PSR Thumb bit */</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">stack</span> = activate(<span class="built_in">stack</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">stack</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œåœ¨mainå‡½æ•¸ä¸­ï¼Œå°æ‡‰çš„èª¿ç”¨æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šç¾©äº†ç¨‹å¼stackçš„æ•¸é‡(2å€‹)å’Œå¤§å°(256*4bytes)</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> user_stacks[TASK_LIMIT][STACK_SIZE];</span><br><span class="line"><span class="comment">//å®šç¾©äº†ç”¨æˆ¶ç¨‹å¼çš„æ•¸é‡(2å€‹)</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> *usertasks[TASK_LIMIT];</span><br><span class="line"><span class="comment">//å°‡ä¹‹å‰å®šç¾©çš„stackå’Œfunctionåœ°å€å‚³çµ¦create_taské…ç½®</span></span><br><span class="line">usertasks[<span class="number">0</span>]=create_task(user_stack[<span class="number">0</span>],&amp;task_func);</span><br></pre></td></tr></table></figure>

<ul>
<li>ç•¶ä½¿ç”¨create_taskå‡½æ•¸ç¬¬ä¸€æ¬¡é€²è¡Œåˆå§‹åŒ–æ™‚ï¼Œåœ¨create_taskä¸­å°taskçš„stacké€²è¡Œäº†é…ç½®ï¼Œä¸¦ä¸”å› çˆ²æ˜¯ç¬¬ä¸€æ¬¡è¨­å®šï¼Œå°‡stack[8]å­˜æ”¾äº†task_funcçš„åœ°å€ï¼Œç„¶å¾Œé€²å…¥åˆ°task_funcä¸­echoâ€task1 Createdâ€&amp;â€returnâ€å¾Œèª¿ç”¨syscallå›åˆ°äº†mainå‡½æ•¸ã€‚</li>
<li>ç•¶ç¬¬äºŒæ¬¡å‘¼å«create_taskæ™‚ï¼Œcommentä¹Ÿæœ‰èªªæ˜ï¼Œå› çˆ²activateæ˜¯å¾exceptionä¸­è¿”å›ï¼Œæ•…å°‡lrä¿å­˜çˆ²THREAD_PSPï¼Œè€Œæ­¤æ™‚çš„funcå¾stack[15]é–‹å§‹</li>
<li>çˆ²ä½•ç·Šæ¥ç€çš„stack[16]å°±è¦è¨­epsrçˆ²0x01000000ï¼Ÿçˆ²ä½•processorå¯ä»¥èªå‡ºé€™æ¢æŒ‡ä»¤æ˜¯è¨­ç½®esprçš„ï¼Ÿ<ul>
<li>The following can clear the T bit to 0: (1)instructionsBLX, BX and POP{PC} (2)restoration from the stacked xPSR value on an exception return (3)bit[0] of the vector value on an exception entry or reset. æ‰€ä»¥éœ€è¦å†å°‡epsrè¨­çˆ²thumb stateã€‚</li>
</ul>
</li>
</ul>
<h3 id="05-TimerInterrupt"><a href="#05-TimerInterrupt" class="headerlink" title="05-TimerInterrupt"></a>05-TimerInterrupt</h3><ul>
<li><p>é¦–å…ˆçœ‹å•“å‹•æ–‡ä»¶ï¼Œå¤šäº†pendsvå’Œsystickçš„å®šç¾©ï¼Œé—œæ–¼<a target="_blank" rel="noopener" href="http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0553a/BABBGBEC.html">Cortex-M3è¨­å‚™çš„ç•°å¸¸é¡å‹</a>å†è¤‡ç¿’ä¸€ä¸‹</p>
</li>
<li><p>void _<em>attribute</em>_((interrupt)) systick_handler(void)</p>
<ul>
<li>The compiler generates function entry and exit sequences suitable for use in an interrupt handler when this attribute is present. With Epiphany targets it may also generate a special section with code to initialize the interrupt vector table.(<a target="_blank" rel="noopener" href="https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html">https://gcc.gnu.org/onlinedocs/gcc/Function-Attributes.html</a>)</li>
</ul>
</li>
</ul>
<h3 id="06-Preemptive"><a href="#06-Preemptive" class="headerlink" title="06-Preemptive"></a>06-Preemptive</h3><ul>
<li>åœ¨context_switch.sä¸­å°systick_handlerå®šç¾©äº†ä¸€æ¨£çš„è¡Œçˆ²ï¼Œç•¶systick exceptionè§¸ç™¼æ™‚ï¼Œä¹Ÿæœƒå°‡é€²ç¨‹åˆ‡æ›åˆ°kernel modeã€‚</li>
<li>ä¸€ç›´æ²’æ‰¾åˆ°delay()å’Œsystickæœ‰ä»€éº¼ç›´æ¥è¯ç¹«ï¼Œæç„¶å¤§æ‚Ÿï¼šç•¶ä¸€å€‹taskåœ¨é‹è¡Œæ™‚ï¼Œç”±æ–¼ç™¼ç”Ÿäº†systick exceptionï¼Œå°±æœƒåˆ‡æ›åˆ°kernel modeç„¶å¾Œé‹è¡Œä¸‹ä¸€å€‹taskï¼Œé€™æ¨£å°±å¦‚åŒpreemptiveã€‚</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>è¯·æˆ‘ä¸€æ¯å’–å•¡å§ï¼</div>
  <button>
    èµèµ
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/reward-wechat.jpg" alt="John Chou å¾®ä¿¡">
        <span>å¾®ä¿¡</span>
      </div>
      <div>
        <img src="/images/reward-alipay.jpg" alt="John Chou æ”¯ä»˜å®">
        <span>æ”¯ä»˜å®</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>John Chou
  </li>
  <li class="post-copyright-link">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://joouis.com/2019/lab-mini-arm-os/" title="ä¸Šæ‰‹ä¸€ä¸ªå…·ä½“è€Œå¾®çš„ARMæ“ä½œç³»ç»Ÿ">https://joouis.com/2019/lab-mini-arm-os/</a>
  </li>
  <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nd/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-ND</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/TechTalk/" rel="tag"># TechTalk</a>
              <a href="/tags/embedded-system-course/" rel="tag"># embedded system course</a>
              <a href="/tags/embedded-system/" rel="tag"># embedded system</a>
              <a href="/tags/arm/" rel="tag"># arm</a>
              <a href="/tags/os/" rel="tag"># os</a>
              <a href="/tags/gnu/" rel="tag"># gnu</a>
              <a href="/tags/context-switch/" rel="tag"># context switch</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/am335x-arm-cortex-a8-boot-sequence/" rel="prev" title="è§£æAM335x Arm Cortex-A8å¤„ç†å™¨çš„å¯åŠ¨æµç¨‹">
                  <i class="fa fa-angle-left"></i> è§£æAM335x Arm Cortex-A8å¤„ç†å™¨çš„å¯åŠ¨æµç¨‹
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/lab-compiler-intro/" rel="next" title="ç¼–è¯‘å™¨å…¥é—¨å°ç¬”è®°">
                  ç¼–è¯‘å™¨å…¥é—¨å°ç¬”è®° <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2016 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Chou</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/sidebar.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/next-boot.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/search/local-search.min.js"></script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/fancybox.min.js"></script>



  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://joouis.com/2019/lab-mini-arm-os/"}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/quicklink.min.js"></script>
<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"joou","count":false,"i18n":{"disqus":"disqus"}}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.22.0/third-party/comments/disqus.min.js"></script>

</body>
</html>
